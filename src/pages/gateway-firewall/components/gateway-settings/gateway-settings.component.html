
<div>
  <div class="bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-700/50 text-yellow-800 dark:text-yellow-300 p-3 rounded-md flex items-start gap-3 mb-6">
    <app-icon name="fas fa-exclamation-triangle" class="mt-1 flex-shrink-0" />
    <div class="text-xs">
      <p>You need to have atleast one Active Directory configured for the identity firewall to work. AD configuration is not present on the system. You can configure AD under Active Directory and turn on the Event Log Source under Identity Firewall.</p>
      <div class="mt-2">
        <a href="#" class="font-semibold underline hover:no-underline mr-4">Configure AD</a>
        <a href="#" class="font-semibold underline hover:no-underline">Turn on Event Log Source</a>
      </div>
    </div>
  </div>

  <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mb-4">
    <div class="flex gap-2">
      <app-dropdown-button
        label="TURN ON"
        [options]="turnOnOffOptions"
        [disabled]="selectedIds().length === 0"
        (select)="handleBulkAction($event, 'on')"
      ></app-dropdown-button>
      <app-dropdown-button
        label="TURN OFF"
        [options]="turnOnOffOptions"
        [disabled]="selectedIds().length === 0"
        (select)="handleBulkAction($event, 'off')"
      ></app-dropdown-button>
    </div>
    <div class="w-full sm:max-w-xs relative">
      <input
        type="text"
        [(ngModel)]="filter"
        placeholder="Filter by Name, Path and more"
        class="w-full pl-3 pr-8 py-2 border border-gray-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-gray-900 dark:text-gray-200 focus:outline-none focus:ring-1 focus:ring-[#679a41]"
      />
      <app-icon name="fas fa-search" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400" />
    </div>
  </div>

  <div class="overflow-x-auto border rounded-lg dark:border-slate-700">
    <table class="min-w-full text-sm">
      <thead class="bg-gray-50 dark:bg-slate-700/50">
        <tr>
          <th class="p-2 w-10 text-left">
            <input 
              type="checkbox" 
              class="w-4 h-4 bg-white dark:bg-slate-800 border-gray-300 dark:border-slate-600 rounded-sm focus:ring-[#679a41] text-[#679a41]" 
              [checked]="isAllSelected()"
              (change)="handleSelectAll($any($event.target).checked)" 
            />
          </th>
          <th class="p-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Gateway Name</th>
          <th class="p-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Type</th>
          <th class="p-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Gateway Firewall</th>
          <th class="p-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Identity Firewall</th>
        </tr>
      </thead>
      <tbody class="bg-white dark:bg-slate-800 divide-y divide-gray-200 dark:divide-slate-700">
        @for (item of filteredSettings(); track item.id) {
          <tr>
            <td class="p-2">
              <input 
                type="checkbox" 
                class="w-4 h-4 bg-white dark:bg-slate-800 border-gray-300 dark:border-slate-600 rounded-sm focus:ring-[#679a41] text-[#679a41]" 
                [checked]="selectedIds().includes(item.id)" 
                (change)="handleSelectOne(item.id, $any($event.target).checked)"
              />
            </td>
            <td class="p-2 text-sm font-medium text-[#293c51] dark:text-gray-200">{{ item.gatewayName }}</td>
            <td class="p-2 text-sm text-gray-500 dark:text-gray-400">{{ item.type }}</td>
            <td class="p-2">
              <div class="flex items-center gap-2 text-gray-600 dark:text-gray-300">
                <app-toggle-switch
                  [ngModel]="item.gatewayFirewallEnabled"
                  (ngModelChange)="handleToggle(item.id, 'gatewayFirewallEnabled')"
                />
                <span class="text-sm text-gray-500 dark:text-gray-400">{{ item.gatewayFirewallEnabled ? 'On' : 'Off' }}</span>
              </div>
            </td>
            <td class="p-2">
              <div class="flex items-center gap-2 text-gray-600 dark:text-gray-300">
                <app-toggle-switch
                  [ngModel]="item.identityFirewallEnabled"
                  (ngModelChange)="handleToggle(item.id, 'identityFirewallEnabled')"
                />
                <span class="text-sm text-gray-500 dark:text-gray-400">{{ item.identityFirewallEnabled ? 'On' : 'Off' }}</span>
              </div>
            </td>
          </tr>
        } @empty {
          <tr>
            <td colspan="5" class="text-center p-6 text-gray-500 dark:text-gray-400">
              No settings found for your filter.
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  <div class="flex justify-between items-center mt-4 text-sm">
    <button class="bg-transparent border border-[#679a41] text-[#679a41] dark:border-[#8cc866] dark:text-[#8cc866] hover:bg-[#679a41]/10 dark:hover:bg-[#8cc866]/10 px-3 py-1.5 rounded-md text-sm font-semibold flex items-center gap-2">
      <app-icon name="fas fa-sync-alt" />
      REFRESH
    </button>
    <span class="text-gray-500 dark:text-gray-400">1 - {{ filteredSettings().length }} of {{ settings().length }}</span>
  </div>
</div>
