<div class="rounded-xl p-6 bg-white dark:bg-slate-800 shadow">
  <!-- Header -->
  <div class="flex flex-wrap justify-between items-center gap-4 mb-6">
    <div>
      <h1 class="text-2xl font-bold text-[#293c51] dark:text-gray-200">Organizations</h1>
      <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Manage your organizations here.</p>
    </div>
  </div>

  <!-- Actions Bar -->
  <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mb-6">
    <!-- Search (left) -->
    <div class="relative w-full sm:max-w-xs">
      <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
        <app-icon name="fas fa-search" className="text-gray-400" />
      </div>
      <input 
        type="text" 
        [(ngModel)]="searchTerm"
        placeholder="Search organizations..."
        class="block w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-slate-600 rounded-md leading-5 bg-white dark:bg-slate-700 text-gray-900 dark:text-gray-200 placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-[#679a41] dark:focus:ring-[#8cc866] focus:border-[#679a41] dark:focus:border-[#8cc866] sm:text-sm"
      />
    </div>

    <!-- Create (right) -->
    <div class="flex items-center gap-4 w-full sm:w-auto">
      <button (click)="openCreateModal()" class="w-full sm:w-auto bg-[#679a41] text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-[#537d34] transition-all duration-200 ease-in-out flex items-center justify-center shadow-sm">
        <app-icon name="fas fa-plus" className="mr-2 text-xs"></app-icon>
        Create Organization
      </button>
    </div>
  </div>

  <div class="shadow-sm sm:rounded-lg overflow-hidden border border-gray-200 dark:border-slate-700">
    <div class="relative">
      <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
        <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-slate-700 dark:text-gray-400">
          <tr>
            <th scope="col" class="p-4">
              <div class="flex items-center">
                <input id="checkbox-all-organizations" type="checkbox" class="w-4 h-4 text-[#679a41] bg-gray-100 border-gray-300 rounded focus:ring-[#537d34] dark:focus:ring-[#8cc866] dark:ring-offset-slate-800 focus:ring-2 dark:bg-slate-700 dark:border-slate-600">
                <label for="checkbox-all-organizations" class="sr-only">checkbox</label>
              </div>
            </th>
            <th scope="col" class="px-6 py-3 cursor-pointer select-none" (click)="setSort('name')">
              <div class="flex items-center">
                Name
                @if (sortColumn() === 'name') {
                  <app-icon [name]="sortDirection() === 'asc' ? 'fas fa-arrow-up' : 'fas fa-arrow-down'" className="ml-2 w-3 h-3"></app-icon>
                }
              </div>
            </th>
            <th scope="col" class="px-6 py-3 cursor-pointer select-none" (click)="setSort('creationDate')">
              <div class="flex items-center">
                Creation Date
                @if (sortColumn() === 'creationDate') {
                  <app-icon [name]="sortDirection() === 'asc' ? 'fas fa-arrow-up' : 'fas fa-arrow-down'" className="ml-2 w-3 h-3"></app-icon>
                }
              </div>
            </th>
            <th scope="col" class="px-6 py-3 cursor-pointer select-none" (click)="setSort('description')">
              <div class="flex items-center">
                Description
                @if (sortColumn() === 'description') {
                  <app-icon [name]="sortDirection() === 'asc' ? 'fas fa-arrow-up' : 'fas fa-arrow-down'" className="ml-2 w-3 h-3"></app-icon>
                }
              </div>
            </th>
            <th scope="col" class="px-6 py-3 text-right">Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (org of filteredOrganizations(); track org.id) {
            <tr class="bg-white border-b dark:bg-slate-800 dark:border-slate-700">
              <td class="w-4 p-4">
                <div class="flex items-center">
                  <input [id]="'checkbox-org-' + org.id" type="checkbox" class="w-4 h-4 text-[#679a41] bg-gray-100 border-gray-300 rounded focus:ring-[#537d34] dark:focus:ring-[#8cc866] dark:ring-offset-slate-800 focus:ring-2 dark:bg-slate-700 dark:border-slate-600">
                  <label [for]="'checkbox-org-' + org.id" class="sr-only">checkbox</label>
                </div>
              </td>
              <td class="px-6 py-4 text-sm font-medium text-gray-900 dark:text-white whitespace-nowrap">
                {{ org.name }}
              </td>
              <td class="px-6 py-4 text-sm text-gray-500 dark:text-gray-400 whitespace-nowrap">
                {{ org.creationDate }}
              </td>
              <td class="px-6 py-4 text-sm text-gray-500 dark:text-gray-400">
                {{ org.description }}
              </td>
              <td class="px-6 py-4 text-right">
                <div class="relative inline-block action-menu-container">
                  <button (click)="toggleActionMenu(org.id)" class="w-8 h-8 flex items-center justify-center rounded-full text-gray-500 hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors" aria-haspopup="true" [attr.aria-expanded]="openActionMenuId() === org.id">
                    <app-icon name="fas fa-ellipsis-v"></app-icon>
                  </button>
                  @if (openActionMenuId() === org.id) {
                    <div class="origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white dark:bg-slate-800 ring-1 ring-black ring-opacity-5 dark:ring-white dark:ring-opacity-10 focus:outline-none z-10 text-left">
                      <a [routerLink]="['/app/cloud-edge/administration/organizations', org.id]" (click)="closeActionMenu()" class="flex items-center px-4 py-2 text-sm text-[#293c51] dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-slate-600 hover:text-[#679a41] dark:hover:text-[#8cc866] transition-colors">
                        <app-icon name="fas fa-address-card" className="w-4 h-4 mr-3" />
                        <span>Organization profile</span>
                      </a>
                      <a href="#" (click)="$event.preventDefault(); openEditModal(org); closeActionMenu()" class="flex items-center px-4 py-2 text-sm text-[#293c51] dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-slate-600 hover:text-[#679a41] dark:hover:text-[#8cc866] transition-colors">
                        <app-icon name="fas fa-pencil-alt" className="w-4 h-4 mr-3" />
                        <span>Edit Organization</span>
                      </a>
                      <div class="border-t border-gray-200 dark:border-slate-700 my-1"></div>
                      <a href="#" (click)="$event.preventDefault(); closeActionMenu()" class="flex items-center px-4 py-2 text-sm text-red-600 dark:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors">
                        <app-icon name="fas fa-trash-alt" className="w-4 h-4 mr-3" />
                        <span>delete</span>
                      </a>
                    </div>
                  }
                </div>
              </td>
            </tr>
          } @empty {
            <tr class="bg-white dark:bg-slate-800">
              <td colspan="5" class="text-center py-10 text-gray-500 dark:text-gray-400">
                <div class="flex flex-col items-center">
                  <app-icon name="fas fa-search" className="text-4xl mb-3"></app-icon>
                  <p class="font-semibold">No organizations found</p>
                  <p class="text-sm">Try adjusting your search or filter.</p>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
    <nav class="flex items-center justify-between p-4 border-t border-gray-200 dark:border-slate-700" aria-label="Table navigation">
      <span class="text-sm font-normal text-gray-500 dark:text-gray-400">
        Showing
        <span class="font-semibold text-gray-900 dark:text-white">1-{{ filteredOrganizations().length }}</span>
        of
        <span class="font-semibold text-gray-900 dark:text-white">{{ filteredOrganizations().length }}</span>
      </span>
      <div class="inline-flex items-center -space-x-px text-sm">
        <a href="#" class="flex items-center justify-center px-3 h-8 ml-0 leading-tight text-gray-500 bg-white border border-gray-300 rounded-l-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-slate-800 dark:border-slate-700 dark:text-gray-400 dark:hover:bg-slate-700 dark:hover:text-white">
          Previous
        </a>
        <a href="#" class="flex items-center justify-center px-3 h-8 leading-tight text-gray-500 bg-white border border-gray-300 rounded-r-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-slate-800 dark:border-slate-700 dark:text-gray-400 dark:hover:bg-slate-700 dark:hover:text-white">
          Next
        </a>
      </div>
    </nav>
  </div>
</div>

<app-create-organization-modal 
  [isOpen]="isModalOpen()"
  [organizationToEdit]="organizationToEdit()" 
  (close)="closeModal()"
  (create)="createOrganization($event)"
  (update)="updateOrganization($event)">
</app-create-organization-modal>