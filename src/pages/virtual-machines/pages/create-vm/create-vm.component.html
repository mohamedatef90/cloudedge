
<div class="bg-white dark:bg-slate-800 rounded-xl shadow p-6">
  <h1 class="text-2xl font-bold text-[#293c51] dark:text-gray-200 mb-6 border-b pb-4 dark:border-slate-700">Create New Virtual Machine</h1>

  <form (ngSubmit)="createVm()" #vmForm="ngForm" class="space-y-8">
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
      <div class="md:col-span-2">
        <label for="vmName" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Virtual Machine Name <span class="text-red-500">*</span></label>
        <input type="text" id="vmName" name="vmName" 
               [ngModel]="vmCreationService.vmName()" (ngModelChange)="vmCreationService.vmName.set($event)"
               required placeholder="Placeholder text"
               class="mt-1 block w-full border border-gray-300 dark:border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-[#679a41] dark:bg-slate-700 sm:text-sm">
      </div>
      <div>
        <label for="reservation" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Reservation <span class="text-red-500">*</span></label>
        <select id="reservation" name="reservation" 
                [ngModel]="vmCreationService.reservation()" (ngModelChange)="vmCreationService.reservation.set($event)"
                required
                class="mt-1 block w-full border border-gray-300 dark:border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-[#679a41] dark:bg-slate-700 sm:text-sm">
          <option value="" disabled>Select Reservation</option>
          @for(res of reservations; track res) { <option [value]="res">{{ res }}</option> }
        </select>
      </div>
      <div>
        <label for="group" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Group <span class="text-red-500">*</span></label>
        <div class="mt-1 flex items-center space-x-2">
          <select id="group" name="group" 
                  [ngModel]="vmCreationService.group()" (ngModelChange)="vmCreationService.group.set($event)"
                  required
                  class="block w-full border border-gray-300 dark:border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-[#679a41] dark:bg-slate-700 sm:text-sm">
            <option value="" disabled>Select Group</option>
            @for(g of groups; track g) { <option [value]="g">{{ g }}</option> }
          </select>
          <button type="button" class="bg-[#293c51] text-white px-3 py-2 rounded-md text-sm font-semibold hover:bg-opacity-90 flex items-center whitespace-nowrap">
            <app-icon name="fas fa-plus" className="mr-2 text-xs"></app-icon>
            Add Group
          </button>
        </div>
      </div>
      <div class="md:col-span-2">
        <label for="osBlueprint" class="block text-sm font-medium text-gray-700 dark:text-gray-300">OS blueprint <span class="text-red-500">*</span></label>
        <select id="osBlueprint" name="osBlueprint" 
                [ngModel]="vmCreationService.osBlueprint()" (ngModelChange)="vmCreationService.osBlueprint.set($event)"
                required
                class="mt-1 block w-full border border-gray-300 dark:border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-[#679a41] dark:bg-slate-700 sm:text-sm">
          <option value="" disabled>Select from recent OSes...</option>
          @for(os of osBlueprintOptions(); track os) { <option [value]="os">{{ os }}</option> }
        </select>
        <a routerLink="/app/cloud-edge/resources/virtual-machines/images" class="mt-2 inline-block text-sm text-sky-600 dark:text-sky-400 hover:underline">Or see all Images <app-icon name="fas fa-arrow-right" className="text-xs ml-1"></app-icon></a>
      </div>
      <div class="md:col-span-2">
        <label for="hostName" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Host Name <span class="text-red-500">*</span></label>
        <input type="text" id="hostName" name="hostName" 
               [ngModel]="vmCreationService.hostName()" (ngModelChange)="vmCreationService.hostName.set($event)"
               required placeholder="Enter virtual machine host name"
               class="mt-1 block w-full border border-gray-300 dark:border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-[#679a41] dark:bg-slate-700 sm:text-sm">
      </div>
      <div class="md:col-span-2">
        <label for="password" class="block text-sm font-medium text-gray-700 dark:text-gray-300">(Root & Worldposta) password <span class="text-red-500">*</span></label>
        <input type="password" id="password" name="password" 
               [ngModel]="vmCreationService.password()" (ngModelChange)="vmCreationService.password.set($event)"
               required placeholder="Enter (Root & Worldposta) password"
               class="mt-1 block w-full border border-gray-300 dark:border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-[#679a41] dark:bg-slate-700 sm:text-sm">
      </div>
      <div class="md:col-span-2">
        <label for="gateway" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Gateway <span class="text-red-500">*</span></label>
        <select id="gateway" name="gateway" 
                [ngModel]="vmCreationService.gateway()" (ngModelChange)="vmCreationService.gateway.set($event)"
                required
                class="mt-1 block w-full border border-gray-300 dark:border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-[#679a41] dark:bg-slate-700 sm:text-sm">
          <option value="" disabled>Select Gateway</option>
          @for(gw of gateways; track gw) { <option [value]="gw">{{ gw }}</option> }
        </select>
      </div>
      <div>
        <label for="cpu" class="block text-sm font-medium text-gray-700 dark:text-gray-300">CPU <span class="text-red-500">*</span></label>
        <input type="number" id="cpu" name="cpu" 
               [ngModel]="vmCreationService.cpu()" (ngModelChange)="vmCreationService.cpu.set(+$event)"
               required min="1"
               class="mt-1 block w-full border border-gray-300 dark:border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-[#679a41] dark:bg-slate-700 sm:text-sm">
        <p class="mt-2 text-xs text-gray-500 dark:text-gray-400 flex items-center">
          <app-icon name="fas fa-info-circle" className="mr-1"></app-icon>
          Available CPU GHz (24), Reserved (76), Total (100)
        </p>
      </div>
      <div>
        <label for="memory" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Memory <span class="text-red-500">*</span></label>
        <input type="number" id="memory" name="memory" 
               [ngModel]="vmCreationService.memory()" (ngModelChange)="vmCreationService.memory.set(+$event)"
               required min="1"
               class="mt-1 block w-full border border-gray-300 dark:border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-[#679a41] dark:bg-slate-700 sm:text-sm">
        <p class="mt-2 text-xs text-gray-500 dark:text-gray-400 flex items-center">
          <app-icon name="fas fa-info-circle" className="mr-1"></app-icon>
          Available Memory (227) GB, Reserved (192) GB, Total (419) GB
        </p>
      </div>
    </div>
    
    <div class="pt-6 border-t dark:border-slate-700">
        @for(disk of vmCreationService.disks(); track $index) {
          <div class="grid grid-cols-1 md:grid-cols-3 gap-x-8 gap-y-4 items-end mb-4">
              <div>
                  <label [for]="'diskName' + $index" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Disk Name <span class="text-red-500">*</span></label>
                  <input type="text" [id]="'diskName' + $index" [name]="'diskName' + $index" 
                         [ngModel]="disk.name" (ngModelChange)="updateDiskProperty($index, 'name', $event)" required
                         class="mt-1 block w-full border border-gray-300 dark:border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-[#679a41] dark:bg-slate-700 sm:text-sm">
              </div>
              <div>
                  <label [for]="'diskSpace' + $index" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Select disk space (GB) <span class="text-red-500">*</span></label>
                  <input type="number" [id]="'diskSpace' + $index" [name]="'diskSpace' + $index" 
                         [ngModel]="disk.size" (ngModelChange)="updateDiskProperty($index, 'size', $event)" required min="1"
                         class="mt-1 block w-full border border-gray-300 dark:border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-[#679a41] dark:bg-slate-700 sm:text-sm">
              </div>
              @if(vmCreationService.disks().length > 1) {
              <div class="pb-2">
                  <button type="button" (click)="removeDisk($index)" class="text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-500 text-sm font-medium">
                      Remove Disk
                  </button>
              </div>
              }
          </div>
        }
        <div>
            <button type="button" (click)="addDisk()" class="text-[#679a41] hover:underline text-sm font-semibold">
                + Add another disk
            </button>
        </div>
    </div>

    <div class="pt-6 border-t dark:border-slate-700">
        <label for="description" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Description</label>
        <textarea id="description" name="description" 
                  [ngModel]="vmCreationService.description()" (ngModelChange)="vmCreationService.description.set($event)"
                  rows="4"
                  placeholder="Enter an optional description for the virtual machine..."
                  class="mt-1 block w-full border border-gray-300 dark:border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-[#679a41] dark:bg-slate-700 sm:text-sm"></textarea>
    </div>

    <div class="pt-5 border-t border-gray-200 dark:border-slate-700">
      <div class="flex justify-end gap-3">
        <button type="button" (click)="cancel()" class="bg-transparent border border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-slate-700 px-4 py-2 rounded-md text-sm font-semibold">
          Cancel
        </button>
        <button type="submit" [disabled]="!vmForm.form.valid" class="bg-[#679a41] text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-[#537d34] disabled:opacity-50 disabled:cursor-not-allowed">
          Create
        </button>
      </div>
    </div>
  </form>
</div>
