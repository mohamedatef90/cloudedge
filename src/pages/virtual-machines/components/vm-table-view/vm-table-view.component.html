

<div class="shadow-sm sm:rounded-lg border border-gray-200 dark:border-slate-700">
  <div class="relative">
    <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
      <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-slate-700 dark:text-gray-400">
        <tr>
          <th scope="col" class="p-4">
            <div class="flex items-center">
              <input id="checkbox-all-vms" type="checkbox" class="w-4 h-4 text-[#679a41] bg-gray-100 border-gray-300 rounded focus:ring-[#537d34] dark:focus:ring-[#8cc866] dark:ring-offset-slate-800 focus:ring-2 dark:bg-slate-700 dark:border-slate-600">
              <label for="checkbox-all-vms" class="sr-only">checkbox</label>
            </div>
          </th>
          <th scope="col" class="px-6 py-3">Name</th>
          <th scope="col" class="px-6 py-3">Status</th>
          <th scope="col" class="px-6 py-3">Specs</th>
          <th scope="col" class="px-6 py-3">IP Address</th>
          <th scope="col" class="px-6 py-3">Reservation</th>
          <th scope="col" class="px-6 py-3">Creation Date</th>
          <th scope="col" class="px-6 py-3 text-right">Actions</th>
        </tr>
      </thead>
      <tbody>
        @for (vm of virtualMachines(); track vm.id; let i = $index; let count = $count) {
          <tr class="bg-white border-b dark:bg-slate-800 dark:border-slate-700 hover:bg-gray-50 dark:hover:bg-slate-700/50">
            <td class="w-4 p-4">
              <div class="flex items-center">
                <input [id]="'checkbox-vm-' + vm.id" type="checkbox" class="w-4 h-4 text-[#679a41] bg-gray-100 border-gray-300 rounded focus:ring-[#537d34] dark:focus:ring-[#8cc866] dark:ring-offset-slate-800 focus:ring-2 dark:bg-slate-700 dark:border-slate-600">
                <label [for]="'checkbox-vm-' + vm.id" class="sr-only">checkbox</label>
              </div>
            </td>
            <td class="px-6 py-4 font-medium text-gray-900 dark:text-white whitespace-nowrap">
              <div class="flex items-center gap-2">
                <app-icon [name]="getOsIcon(vm.os)" className="text-xl" />
                <a [routerLink]="['/app/cloud-edge/resources/virtual-machines', vm.id]" class="hover:underline hover:text-[#679a41] dark:hover:text-[#8cc866]">{{ vm.name }}</a>
              </div>
            </td>
            <td class="px-6 py-4">
              <span [class]="getStatusClass(vm.status)" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize">
                {{ vm.status }}
              </span>
            </td>
            <td class="px-6 py-4 text-gray-600 dark:text-gray-300">
              {{ vm.cores }} Cores / {{ vm.memory }}GB / {{ vm.storage }}GB
            </td>
            <td class="px-6 py-4 font-mono">{{ vm.ipAddress }}</td>
            <td class="px-6 py-4">{{ vm.reservationName ?? 'None' }}</td>
            <td class="px-6 py-4">{{ vm.creationDate }}</td>
            <td class="px-6 py-4 text-right">
              <div class="flex items-center justify-end gap-2">
                <a [routerLink]="['/app/cloud-edge/resources/virtual-machines', vm.id]" title="Profile" class="bg-transparent text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700 w-8 h-8 rounded-full flex items-center justify-center border border-gray-300 dark:border-slate-600">
                  <app-icon name="fas fa-desktop" />
                </a>
                <button (click)="handleAction('connect', vm)" title="Web Console" class="bg-[#679a41] text-white hover:bg-[#537d34] w-8 h-8 rounded-full flex items-center justify-center">
                  <app-icon name="fas fa-terminal" />
                </button>
                <div class="relative vm-menu-container inline-block text-left">
                  <button (click)="toggleMenu($event, vm.id)" class="text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-slate-700 w-8 h-8 rounded-full flex items-center justify-center">
                    <app-icon name="fas fa-ellipsis-v" />
                  </button>
                   @if (openMenuId() === vm.id) {
                    <div class="absolute right-0 w-56 rounded-md shadow-lg bg-white dark:bg-slate-800 ring-1 ring-black ring-opacity-5 dark:ring-white dark:ring-opacity-10 z-10 text-sm"
                         [class.origin-top-right]="i < count - 3"
                         [class.mt-2]="i < count - 3"
                         [class.origin-bottom-right]="i >= count - 3"
                         [class.bottom-full]="i >= count - 3"
                         [class.mb-2]="i >= count - 3">
                      <div class="py-1">
                        <a [routerLink]="['/app/cloud-edge/resources/virtual-machines', vm.id]" class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-slate-700">
                          <app-icon name="fas fa-cog" className="w-5 mr-3" /> Settings
                        </a>
                        <a href="#" (click)="$event.preventDefault(); handleAction('powerOff', vm)" class="flex items-center px-4 py-2" [class.text-gray-400]="vm.status !== 'running'" [class.dark:text-gray-500]="vm.status !== 'running'" [class.pointer-events-none]="vm.status !== 'running'" [class.text-gray-700]="vm.status === 'running'" [class.dark:text-gray-200]="vm.status === 'running'" [class.hover:bg-gray-100]="vm.status === 'running'" [class.dark:hover:bg-slate-700]="vm.status === 'running'">
                          <app-icon name="fas fa-power-off" className="w-5 mr-3 text-orange-500" /> Guest ShutDown
                        </a>
                        <a href="#" (click)="$event.preventDefault(); handleAction('restart', vm)" class="flex items-center px-4 py-2" [class.text-gray-400]="vm.status !== 'running'" [class.dark:text-gray-500]="vm.status !== 'running'" [class.pointer-events-none]="vm.status !== 'running'" [class.text-gray-700]="vm.status === 'running'" [class.dark:text-gray-200]="vm.status === 'running'" [class.hover:bg-gray-100]="vm.status === 'running'" [class.dark:hover:bg-slate-700]="vm.status === 'running'">
                          <app-icon name="fas fa-sync-alt" className="w-5 mr-3 text-orange-500" /> Guest Restart
                        </a>
                         <div class="border-t border-gray-200 dark:border-slate-700 my-1"></div>
                        <button (click)="$event.preventDefault(); handleAction('powerOff', vm)" [disabled]="vm.status !== 'running'" class="w-full text-left flex items-center px-4 py-2 disabled:text-gray-400 disabled:dark:text-gray-500 disabled:pointer-events-none text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-slate-700">
                          <app-icon name="fas fa-stop-circle" className="w-5 mr-3 text-red-500" /> Power Off
                        </button>
                        <button (click)="$event.preventDefault(); handleAction('restart', vm)" [disabled]="vm.status !== 'running'" class="w-full text-left flex items-center px-4 py-2 disabled:text-gray-400 disabled:dark:text-gray-500 disabled:pointer-events-none text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-slate-700">
                          <app-icon name="fas fa-redo" className="w-5 mr-3 text-red-500" /> Restart
                        </button>
                        <a href="#" class="flex items-center px-4 py-2" [class.text-gray-400]="vm.status !== 'running'" [class.dark:text-gray-500]="vm.status !== 'running'" [class.pointer-events-none]="vm.status !== 'running'" [class.text-gray-700]="vm.status === 'running'" [class.dark:text-gray-200]="vm.status === 'running'" [class.hover:bg-gray-100]="vm.status === 'running'" [class.dark:hover:bg-slate-700]="vm.status === 'running'">
                          <app-icon name="fas fa-pause-circle" className="w-5 mr-3 text-yellow-500" /> Suspend
                        </a>
                         <div class="border-t border-gray-200 dark:border-slate-700 my-1"></div>
                        <a href="#" class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-slate-700">
                          <app-icon name="fas fa-camera-retro" className="w-5 mr-3" /> Create Snapshot
                        </a>
                         <a href="#" class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-slate-700">
                          <app-icon name="fas fa-clone" className="w-5 mr-3" /> Clone VM
                        </a>
                         <div class="border-t border-gray-200 dark:border-slate-700 my-1"></div>
                        <button (click)="$event.preventDefault(); handleAction('delete', vm)" class="w-full text-left flex items-center px-4 py-2 text-red-600 dark:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20">
                          <app-icon name="fas fa-trash-alt" className="w-5 mr-3" /> Delete VM
                        </button>
                      </div>
                    </div>
                  }
                </div>
              </div>
            </td>
          </tr>
        } @empty {
          <tr class="bg-white dark:bg-slate-800">
            <td colspan="8" class="text-center py-10 text-gray-500 dark:text-gray-400">
              <div class="flex flex-col items-center">
                <app-icon name="fas fa-server" className="text-4xl mb-3"></app-icon>
                <p class="font-semibold">No virtual machines found</p>
                <p class="text-sm">Click "Add VM" to create one.</p>
              </div>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>
</div>
