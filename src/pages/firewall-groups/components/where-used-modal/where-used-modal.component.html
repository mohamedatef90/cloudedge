@if (isOpen() && group()) {
<div (click)="onClose()" class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm">
    <div (click)="onDialogClick($event)" class="bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-5xl m-4 flex flex-col h-[80vh]">
        
        <!-- Custom Header -->
        <div class="p-4 flex-shrink-0">
            <div class="flex justify-between items-start pb-4 border-b dark:border-gray-700">
                <div>
                    <h3 class="text-xl font-semibold text-[#293c51] dark:text-gray-100">
                        Where Used | {{ group()?.name }}
                    </h3>
                     <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">
                        Click on the link to go to the page where the object is used.
                    </p>
                </div>
                <div class="flex items-center gap-4">
                    <div class="w-64 relative">
                        <input 
                            type="text"
                            [(ngModel)]="searchTerm"
                            placeholder="Search"
                            class="block w-full pl-3 pr-8 py-2 border border-gray-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-gray-900 dark:text-gray-200 focus:outline-none focus:ring-1 focus:ring-[#679a41]"
                          />
                          <app-icon name="fas fa-search" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400" />
                    </div>
                    <button (click)="onClose()" class="p-1 rounded-md hover:bg-gray-100 dark:hover:bg-slate-700">
                        <app-icon name="fas fa-times" className="text-xl text-gray-500 dark:text-gray-400" />
                    </button>
                </div>
            </div>
        </div>

        <!-- Content -->
        <div class="flex-grow overflow-y-auto px-4">
            <div class="border rounded-md dark:border-gray-700 flex flex-col h-full">
                <table class="min-w-full">
                    <thead class="bg-gray-50 dark:bg-slate-700 sticky top-0">
                        <tr>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase w-1/3">Service/Entity</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase w-2/3">Location</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white dark:bg-slate-800 divide-y divide-gray-200 dark:divide-slate-700">
                      @if (filteredReferences().length > 0) {
                        @for (ref of filteredReferences(); track ref.id) {
                            <tr>
                                <td class="px-4 py-3 text-sm text-[#293c51] dark:text-gray-200">{{ ref.serviceEntity }}</td>
                                <td class="px-4 py-3 text-sm text-[#293c51] dark:text-gray-200">
                                    <div class="flex items-center flex-wrap gap-x-1">
                                        <a href="#" class="text-sky-500 hover:underline">
                                            {{ ref.location.path.join(' > ') }}
                                        </a>
                                        <app-icon name="fas fa-chevron-right" className="text-xs text-gray-400 mx-1" />
                                        <span>({{ ref.location.target }})</span>
                                    </div>
                                </td>
                            </tr>
                        }
                      } @else {
                        <tr>
                            <td colspan="2" class="h-full">
                                <div class="flex flex-col items-center justify-center text-center p-8 text-gray-500 dark:text-gray-400" style="min-height: 200px;">
                                    <app-icon name="fas fa-file-magnifying-glass" className="text-5xl text-gray-300 dark:text-gray-600 mb-4"></app-icon>
                                    <p class="font-semibold">No References Found</p>
                                </div>
                            </td>
                        </tr>
                      }
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="p-4 flex-shrink-0 flex justify-between items-center bg-gray-50 dark:bg-slate-800/50 border-t dark:border-slate-700">
            <span class="text-sm text-gray-500 dark:text-gray-400">Total: {{ filteredReferences().length }}</span>
            <button (click)="onClose()" class="bg-transparent text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700 px-4 py-2 rounded-md text-sm font-semibold">CLOSE</button>
        </div>
    </div>
</div>
}