<div class="bg-[#f7f8fa] dark:bg-slate-900 -m-6 p-6 min-h-full">
  <!-- Header -->
  <div class="flex flex-wrap justify-between items-center gap-4 mb-6">
    <div>
      <h1 class="text-2xl font-bold text-[#293c51] dark:text-gray-200">CloudEdge Console</h1>
    </div>
    <div class="flex items-center space-x-2">
      <button class="bg-[#679a41] text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-[#537d34] transition-all duration-200 ease-in-out flex items-center shadow-sm">
        <app-icon name="fas fa-plus" className="mr-2 text-xs"></app-icon>
        Create VM
      </button>
      <button class="bg-transparent border border-[#679a41] text-[#679a41] dark:border-[#8cc866] dark:text-[#8cc866] hover:bg-[#679a41]/10 dark:hover:bg-[#8cc866]/10 px-4 py-2 rounded-md text-sm font-semibold transition-all duration-200 ease-in-out flex items-center shadow-sm">
        <app-icon name="fas fa-shield-halved" className="mr-2 text-xs"></app-icon>
        Security Scan
      </button>
    </div>
  </div>

  <!-- Welcome Card for New Users -->
  @if (showWelcomeCard()) {
    <div class="relative bg-white dark:bg-slate-800 bg-gradient-to-br from-[#679a41]/10 dark:from-[#8cc866]/10 to-transparent rounded-xl shadow p-6 mb-6">
      <button (click)="dismissWelcomeCard()" class="absolute top-4 right-4 text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
        <app-icon name="fas fa-times" />
      </button>
      <h2 class="text-lg font-semibold text-[#293c51] dark:text-gray-200">Welcome to CloudEdge, {{ user()?.displayName || 'User' }}!</h2>
      <p class="mt-2 text-sm font-medium text-[#293c51] dark:text-gray-300">We're glad to have you here. Here are some quick links to help you get started:</p>
      
      <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        @for (link of quickStartLinks(); track link.title) {
          <a [routerLink]="link.path" class="group bg-white/50 dark:bg-slate-800/50 hover:bg-white dark:hover:bg-slate-700/80 p-4 rounded-lg shadow-sm border border-transparent hover:border-gray-200 dark:hover:border-slate-600 transition-all duration-200 flex items-start space-x-4">
            <div class="flex-shrink-0 w-10 h-10 flex items-center justify-center bg-[#679a41]/20 text-[#679a41] dark:bg-[#8cc866]/20 dark:text-[#8cc866] rounded-lg">
              <app-icon [name]="link.icon" className="text-xl" />
            </div>
            <div>
              <h3 class="font-medium text-sm text-[#293c51] dark:text-gray-200 group-hover:text-[#679a41] dark:group-hover:text-[#8cc866] transition-colors">{{ link.title }}</h3>
              <p class="text-sm text-gray-500 dark:text-gray-400">{{ link.description }}</p>
            </div>
          </a>
        }
      </div>
    </div>
  }

  <!-- Stats Grid -->
  <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6 mb-6">
    @for(stat of animatedStats(); track stat.title) {
      <div class="bg-white dark:bg-slate-800 rounded-xl shadow p-6 flex flex-col transition-all duration-200 ease-in-out">
        <div class="flex justify-between items-start">
          <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400">{{ stat.title }}</h3>
          <div class="text-gray-400 dark:text-gray-500">
            <app-icon [name]="stat.icon" className="text-lg"></app-icon>
          </div>
        </div>
        <div class="mt-2">
          <span class="text-3xl font-bold text-[#293c51] dark:text-gray-200">{{ stat.value }}</span>
          <span class="text-sm text-gray-500 dark:text-gray-400"> / {{ stat.total }} {{ stat.unit }}</span>
        </div>
        <div class="mt-auto pt-4">
          <div class="bg-gray-200 dark:bg-slate-700 rounded-full h-1.5 w-full overflow-hidden">
            <div class="h-1.5 rounded-full transition-all duration-1000 ease-out"
                 [class.bg-[#FF9800]]="stat.title === 'CPU Cores' && stat.percentage < 90"
                 [class.bg-[#4285F4]]="stat.title === 'Memory' && stat.percentage < 90"
                 [class.bg-[#4CAF50]]="stat.title === 'Storage' && stat.percentage < 90"
                 [class.bg-[#679a41]]="stat.title === 'Active VMs' && stat.percentage < 90"
                 [class.bg-[#F44336]]="stat.percentage >= 90"
                 [style.width.%]="stat.animatedPercentage"></div>
          </div>
          <div class="text-xs mt-2" 
               [class.text-[#679a41]]="stat.percentage < 90"
               [class.dark:text-[#8cc866]]="stat.percentage < 90"
               [class.text-[#F44336]]="stat.percentage >= 90"
               [class.dark:text-[#F44336]]="stat.percentage >= 90">
            @if(stat.uptime) {
              <span>{{ stat.uptime }}</span>
            } @else {
              <span>{{ stat.percentage }}% {{ stat.label }}</span>
            }
          </div>
        </div>
      </div>
    }
  </div>
  
  <!-- Main Content Grid -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Left Column -->
    <div class="lg:col-span-2 space-y-6">

      <!-- Top VMs -->
      <div class="bg-white dark:bg-slate-800 rounded-xl shadow p-6">
        <div class="flex justify-between items-center">
          <h3 class="text-lg font-semibold text-[#293c51] dark:text-gray-200">Top VMs by Resource Usage</h3>
          <a routerLink="/app/cloud-edge/resources/virtual-machines" class="text-sm text-[#679a41] dark:text-[#8cc866] hover:underline">View All VMs</a>
        </div>
        <hr class="my-4 border-gray-200 dark:border-slate-700">
        <div class="flow-root">
          <ul role="list" class="-my-4 divide-y divide-gray-200 dark:divide-slate-700">
            @for (vm of animatedTopVMs(); track vm.id) {
              <li class="flex items-center py-4 space-x-4">
                <div class="flex-shrink-0">
                  <span class="relative flex h-3 w-3">
                    @if (vm.status === 'running') {
                      <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-[#4CAF50] opacity-75"></span>
                      <span class="relative inline-flex rounded-full h-3 w-3 bg-[#4CAF50]"></span>
                    } @else {
                      <span class="relative inline-flex rounded-full h-3 w-3 bg-[#F44336]"></span>
                    }
                  </span>
                </div>
                <div class="min-w-0 flex-1">
                  <div class="flex items-center space-x-2">
                    @switch (vm.os) {
                      @case ('windows') {
                        <app-icon name="fab fa-windows" className="text-lg text-blue-500"></app-icon>
                      }
                      @case ('ubuntu') {
                        <app-icon name="fab fa-ubuntu" className="text-lg text-orange-500"></app-icon>
                      }
                      @case ('linux') {
                        <app-icon name="fab fa-linux" className="text-lg text-gray-700 dark:text-gray-300"></app-icon>
                      }
                    }
                    <p class="text-sm font-medium text-[#293c51] dark:text-gray-200 truncate">{{ vm.name }}</p>
                  </div>
                  <div class="mt-2 space-y-2">
                     <!-- CPU -->
                     <div class="flex items-center">
                       <span class="text-xs font-medium text-gray-500 dark:text-gray-400 w-16">CPU</span>
                       <div class="w-full bg-gray-200 dark:bg-slate-700 rounded-full h-1.5">
                         <div class="bg-[#FF9800] h-1.5 rounded-full transition-all duration-1000 ease-out" [style.width.%]="vm.animatedUsage.cpu"></div>
                       </div>
                       <span class="text-xs font-medium text-gray-500 dark:text-gray-400 w-10 text-right">{{ vm.cpu.usage }}%</span>
                     </div>
                     <!-- Memory -->
                     <div class="flex items-center">
                       <span class="text-xs font-medium text-gray-500 dark:text-gray-400 w-16">Memory</span>
                       <div class="w-full bg-gray-200 dark:bg-slate-700 rounded-full h-1.5">
                         <div class="bg-[#4285F4] h-1.5 rounded-full transition-all duration-1000 ease-out" [style.width.%]="vm.animatedUsage.memory"></div>
                       </div>
                       <span class="text-xs font-medium text-gray-500 dark:text-gray-400 w-10 text-right">{{ vm.memory.usage }}%</span>
                     </div>
                     <!-- Storage -->
                     <div class="flex items-center">
                       <span class="text-xs font-medium text-gray-500 dark:text-gray-400 w-16">Storage</span>
                       <div class="w-full bg-gray-200 dark:bg-slate-700 rounded-full h-1.5">
                         <div class="bg-[#4CAF50] h-1.5 rounded-full transition-all duration-1000 ease-out" [style.width.%]="vm.animatedUsage.storage"></div>
                       </div>
                       <span class="text-xs font-medium text-gray-500 dark:text-gray-400 w-10 text-right">{{ vm.storage.usage }}%</span>
                     </div>
                  </div>
                </div>
                <div class="flex-shrink-0 relative vm-menu-container">
                  <button (click)="toggleVmMenu(vm.id)" class="w-8 h-8 flex items-center justify-center rounded-full text-gray-500 hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors" aria-haspopup="true" [attr.aria-expanded]="openVmMenuId() === vm.id">
                    <app-icon name="fas fa-ellipsis-v"></app-icon>
                  </button>
                  @if (openVmMenuId() === vm.id) {
                    <div class="origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white dark:bg-slate-800 ring-1 ring-black ring-opacity-5 dark:ring-white dark:ring-opacity-10 focus:outline-none z-10">
                      <a href="#" (click)="$event.preventDefault(); closeVmMenu()" class="flex items-center px-4 py-2 text-sm text-[#293c51] dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-slate-600 hover:text-[#679a41] dark:hover:text-[#8cc866] transition-colors" [class.text-gray-400]="vm.status !== 'running'" [class.dark:text-gray-500]="vm.status !== 'running'" [class.pointer-events-none]="vm.status !== 'running'">
                        <app-icon name="fas fa-plug" className="w-4 h-4 mr-3" />
                        <span>Connect</span>
                      </a>
                      <a href="#" (click)="$event.preventDefault(); closeVmMenu()" class="flex items-center px-4 py-2 text-sm text-[#293c51] dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-slate-600 hover:text-[#679a41] dark:hover:text-[#8cc866] transition-colors">
                        <app-icon name="fas fa-tasks-alt" className="w-4 h-4 mr-3" />
                        <span>Manage</span>
                      </a>
                      <a routerLink="/app/cloud-edge/resources/virtual-machines" (click)="closeVmMenu()" class="flex items-center px-4 py-2 text-sm text-[#293c51] dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-slate-600 hover:text-[#679a41] dark:hover:text-[#8cc866] transition-colors">
                        <app-icon name="fas fa-info-circle" className="w-4 h-4 mr-3" />
                        <span>View Details</span>
                      </a>
                      <div class="border-t border-gray-200 dark:border-slate-700 my-1"></div>
                      <a href="#" (click)="$event.preventDefault(); closeVmMenu()" class="flex items-center px-4 py-2 text-sm text-red-600 dark:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors">
                        <app-icon name="fas fa-trash-alt" className="w-4 h-4 mr-3" />
                        <span>Delete</span>
                      </a>
                    </div>
                  }
                </div>
              </li>
            }
          </ul>
        </div>
      </div>
      
      <!-- Recent Activity -->
      <div class="bg-white dark:bg-slate-800 rounded-xl shadow p-6">
        <div class="flex justify-between items-center">
          <h3 class="text-lg font-semibold text-[#293c51] dark:text-gray-200">Recent Activity</h3>
          <button class="text-sm text-[#679a41] dark:text-[#8cc866] hover:underline">View All</button>
        </div>
        <hr class="my-4 border-gray-200 dark:border-slate-700">
        <div class="flow-root">
          <ul role="list" class="-my-4 divide-y divide-gray-200 dark:divide-slate-700">
            @for (activity of recentActivities(); track $index) {
              <li class="py-4">
                <div class="flex items-start space-x-4">
                  <div class="flex-shrink-0 pt-0.5">
                    <app-icon [name]="activity.icon" className="h-5 w-5"></app-icon>
                  </div>
                  <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-[#293c51] dark:text-gray-200">{{ activity.description }}</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">
                      <span>{{ activity.timestamp }} by </span>
                      <span class="font-medium">{{ activity.user }}</span>
                    </p>
                  </div>
                </div>
              </li>
            }
          </ul>
        </div>
      </div>
    </div>

    <!-- Right Column -->
    <div class="space-y-6">
      <!-- Security Score -->
      <div class="bg-white dark:bg-slate-800 rounded-xl shadow p-6">
        <div class="flex justify-between items-center">
          <h3 class="text-lg font-semibold text-[#293c51] dark:text-gray-200">Security Score</h3>
          <span class="text-xs font-semibold bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 px-2 py-1 rounded-full">Active</span>
        </div>
        <hr class="my-4 border-gray-200 dark:border-slate-700">
        <div class="flex flex-col items-center">
            <div class="relative w-40 h-40">
                <svg class="w-full h-full" viewBox="0 0 140 140">
                    <circle class="text-gray-200 dark:text-slate-700" stroke-width="12" stroke="currentColor" fill="transparent" r="60" cx="70" cy="70" />
                    <circle class="text-[#679a41]" stroke-width="12" [attr.stroke-dasharray]="securityScoreCircumference" [attr.stroke-dashoffset]="securityScoreOffset()" stroke-linecap="round" stroke="currentColor" fill="transparent" r="60" cx="70" cy="70" style="transform: rotate(-90deg); transform-origin: 50% 50%; transition: stroke-dashoffset 1s ease-out;" />
                </svg>
                <div class="absolute inset-0 flex items-center justify-center">
                    <span class="text-4xl font-bold text-[#293c51] dark:text-gray-200">{{ securityScore().score }}%</span>
                </div>
            </div>
            <div class="w-full mt-4 space-y-2 text-sm">
              <div class="flex justify-between items-center border-b border-gray-100 dark:border-slate-700 py-2">
                <span class="font-medium text-[#293c51] dark:text-gray-200">Active Threats</span>
                <span class="font-semibold text-red-500">{{ securityScore().activeThreats }}</span>
              </div>
               <div class="flex justify-between items-center border-b border-gray-100 dark:border-slate-700 py-2">
                <span class="font-medium text-[#293c51] dark:text-gray-200">Blocked Attempts</span>
                <span class="font-medium text-[#293c51] dark:text-gray-200">{{ securityScore().blockedAttempts }}</span>
              </div>
               <div class="flex justify-between items-center py-2">
                <span class="font-medium text-[#293c51] dark:text-gray-200">SSL Certificates</span>
                <span class="font-semibold text-[#679a41] dark:text-[#8cc866]">{{ securityScore().sslCertificates }}</span>
              </div>
            </div>
        </div>
      </div>
      
      <!-- Network Status -->
      <div class="bg-white dark:bg-slate-800 rounded-xl shadow p-6">
        <div class="flex justify-between items-center">
          <h3 class="text-lg font-semibold text-[#293c51] dark:text-gray-200">Network Status</h3>
          <span class="text-xs font-semibold bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 px-2 py-1 rounded-full">Healthy</span>
        </div>
        <hr class="my-4 border-gray-200 dark:border-slate-700">
        <div class="space-y-4 text-sm">
          <div>
            <div class="flex justify-between mb-1">
              <span class="font-medium text-[#293c51] dark:text-gray-200">Bandwidth Usage</span>
              <span class="font-medium text-[#293c51] dark:text-gray-200">{{ networkStatus().bandwidthUsage.used }} / {{ networkStatus().bandwidthUsage.total }} {{ networkStatus().bandwidthUsage.unit }}</span>
            </div>
            <div class="bg-gray-200 dark:bg-slate-700 rounded-full h-1.5 w-full overflow-hidden">
              <div class="bg-[#9C27B0] h-1.5 rounded-full" [style.width.%]="networkStatus().bandwidthUsage.percentage"></div>
            </div>
          </div>
           <div class="flex justify-between items-center">
            <span class="font-medium text-[#293c51] dark:text-gray-200">Latency</span>
            <span class="font-semibold text-[#679a41] dark:text-[#8cc866]">{{ networkStatus().latency }}</span>
          </div>
           <div class="flex justify-between items-center">
            <span class="font-medium text-[#293c51] dark:text-gray-200">Active Connections</span>
            <span class="font-medium text-[#293c51] dark:text-gray-200">{{ networkStatus().activeConnections }}</span>
          </div>
           <div class="flex justify-between items-center">
            <span class="font-medium text-[#293c51] dark:text-gray-200">Packet Loss</span>
            <span class="font-semibold text-[#679a41] dark:text-[#8cc866]">{{ networkStatus().packetLoss }}</span>
          </div>
        </div>
      </div>
      
      <!-- Helpful Resources -->
      <div class="bg-white dark:bg-slate-800 rounded-xl shadow p-6">
        <h3 class="text-lg font-semibold text-[#293c51] dark:text-gray-200">Helpful Resources</h3>
        <hr class="my-4 border-gray-200 dark:border-slate-700">
        <ul class="-mx-2 -my-1">
          @for (resource of helpfulResources(); track resource.title) {
            <li>
              <a [routerLink]="resource.path" class="group flex items-start space-x-4 p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700/50 transition-colors">
                <div class="flex-shrink-0 w-8 h-8 flex items-center justify-center bg-[#679a41]/10 text-[#679a41] dark:bg-[#8cc866]/10 dark:text-[#8cc866] rounded-md mt-0.5">
                  <app-icon [name]="resource.icon" className="text-base"></app-icon>
                </div>
                <div>
                  <h4 class="font-medium text-sm text-[#293c51] dark:text-gray-200 group-hover:text-[#679a41] dark:group-hover:text-[#8cc866] transition-colors">{{ resource.title }}</h4>
                  <p class="text-xs text-gray-500 dark:text-gray-400 leading-tight">{{ resource.description }}</p>
                </div>
              </a>
            </li>
          }
        </ul>
      </div>

      <!-- System Alerts -->
      <div class="bg-white dark:bg-slate-800 rounded-xl shadow p-6">
        <div class="flex justify-between items-center">
          <h3 class="text-lg font-semibold text-[#293c51] dark:text-gray-200">System Alerts</h3>
          <span class="flex h-6 w-6 items-center justify-center rounded-full bg-red-500 text-xs font-bold text-white">3</span>
        </div>
        <hr class="my-4 border-gray-200 dark:border-slate-700">
        <div class="text-gray-400 dark:text-gray-500">Alerts will be displayed here</div>
      </div>
    </div>
  </div>
</div>